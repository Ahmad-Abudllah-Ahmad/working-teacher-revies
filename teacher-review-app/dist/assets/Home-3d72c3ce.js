import{r as h,j as e,L as v}from"./index-9421cb2d.js";import{a as j,s as u,b as w}from"./api-5fb399bc.js";const b=({teacher:t})=>{const[a,m]=h.useState({overall:0,teaching:0,attendance:0,professional:0});h.useEffect(()=>{(async()=>{try{const o=await j.get(`/reviews/teacher/${t.id}`);if(o.data&&Array.isArray(o.data)){const s=o.data.filter(r=>r.status==="approved");if(s.length>0){const r=s.reduce((l,n)=>({overall:l.overall+n.rating,teaching:l.teaching+n.metrics.teaching,attendance:l.attendance+n.metrics.engagement,professional:l.professional+n.metrics.approachability}),{overall:0,teaching:0,attendance:0,professional:0});m({overall:r.overall/s.length,teaching:r.teaching/s.length,attendance:r.attendance/s.length,professional:r.professional/s.length})}}}catch(o){console.error("Error fetching reviews:",o);const s=localStorage.getItem("teacherReviewApp_reviews");if(s)try{const l=JSON.parse(s).filter(n=>n.teacherId===t.id&&n.status==="approved");if(l.length>0){const n=l.reduce((g,p)=>({overall:g.overall+p.rating,teaching:g.teaching+p.metrics.teaching,attendance:g.attendance+p.metrics.engagement,professional:g.professional+p.metrics.approachability}),{overall:0,teaching:0,attendance:0,professional:0});m({overall:n.overall/l.length,teaching:n.teaching/l.length,attendance:n.attendance/l.length,professional:n.professional/l.length})}}catch(r){console.error("Error parsing cached reviews:",r)}}})()},[t.id]);const i=x=>[...Array(5)].map((o,s)=>e.jsx("svg",{className:`w-4 h-4 ${s<Math.round(x)?"text-yellow-400":"text-gray-300"}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})},s));return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden transition-all hover:shadow-md",children:[e.jsxs("div",{className:"relative h-48 bg-gray-200",children:[e.jsx("img",{src:t.photo||"/assets/images/teacher-placeholder.jpg",alt:t.name,className:"w-full h-full object-cover",onError:x=>{x.target.src="/assets/images/teacher-placeholder.jpg"}}),a.overall>0&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-400 text-yellow-900 text-sm font-bold rounded-full w-10 h-10 flex items-center justify-center shadow-md",children:a.overall.toFixed(1)})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 truncate",children:t.name}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:t.field}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.experience," years"]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Overall Grade"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex mr-1",children:i(a.overall)}),e.jsx("span",{className:"text-xs font-medium text-black",children:a.overall.toFixed(1)})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Teaching Quality"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex mr-1",children:i(a.teaching)}),e.jsx("span",{className:"text-xs font-medium text-black",children:a.teaching.toFixed(1)})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Attendance & Support"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex mr-1",children:i(a.attendance)}),e.jsx("span",{className:"text-xs font-medium text-black",children:a.attendance.toFixed(1)})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Professional Behavior"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex mr-1",children:i(a.professional)}),e.jsx("span",{className:"text-xs font-medium text-black",children:a.professional.toFixed(1)})]})]})]}),e.jsx("div",{className:"mt-4 flex justify-between items-center",children:e.jsx("span",{className:"text-primary-600 text-sm font-medium",children:"View Profile"})})]})]})},S=({onSearch:t})=>{const[a,m]=h.useState(""),i=s=>{const r=s.target.value;m(r),t(r)},x=s=>{s.preventDefault(),t(a)},o=()=>{m(""),t("")};return e.jsx("form",{onSubmit:x,className:"relative",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"search",className:"block w-full pl-10 pr-10 py-3 text-sm text-gray-900 bg-white border border-gray-200 rounded-lg focus:ring-primary-500 focus:border-primary-500",placeholder:"Search for teachers by name or field...",value:a,onChange:i}),a&&e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 flex items-center pr-3",onClick:o,children:e.jsx("svg",{className:"w-5 h-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},C=()=>{const[t,a]=h.useState([]),[m,i]=h.useState([]),[x,o]=h.useState(!0),[s,r]=h.useState(null),[l,n]=h.useState("disconnected"),g=async()=>{try{o(!0);const d=[...(await j.get("/teachers")).data].sort((y,N)=>y.name.localeCompare(N.name));a(d),i(d),r(null)}catch(c){console.error("Error fetching teachers:",c),r("Failed to load teachers. Please try again.");const f=localStorage.getItem("teacherReviewApp_teachers");if(f)try{const d=JSON.parse(f);a(d),i(d)}catch(d){console.error("Error parsing cached teachers:",d)}}finally{o(!1)}};h.useEffect(()=>{g(),u.on("connect",()=>{n("connected"),console.log("Socket connected")}),u.on("disconnect",()=>{n("disconnected"),console.log("Socket disconnected")});const c=w(()=>{console.log("Teachers updated, refreshing data"),g()},()=>{console.log("Reviews updated, refreshing data"),g()});return()=>{c(),u.off("connect"),u.off("disconnect")}},[]),h.useEffect(()=>{t.length>0&&localStorage.setItem("teacherReviewApp_teachers",JSON.stringify(t))},[t]);const p=c=>{if(!c.trim()){i(t);return}const f=t.filter(d=>d.name.toLowerCase().includes(c.toLowerCase())||d.field.toLowerCase().includes(c.toLowerCase()));i(f)};return x?e.jsx("div",{className:"flex h-screen w-full items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-xl",children:"Loading teachers..."})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary-600 text-white py-6",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Teacher Review Platform"}),e.jsx("p",{className:"mt-2",children:"Anonymously review and rate your teachers"})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[l==="disconnected"&&e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsx("p",{className:"text-yellow-700",children:"Working in offline mode. Some features may be limited."})}),s&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-red-700",children:s})}),e.jsx("div",{className:"mb-8",children:e.jsx(S,{onSearch:p})}),m.length===0?e.jsx("div",{className:"text-center py-10",children:e.jsx("h2",{className:"text-xl text-gray-600",children:"No teachers found matching your search criteria"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:m.map(c=>e.jsx(v,{to:`/teacher/${c.id}`,className:"no-underline",children:e.jsx(b,{teacher:c})},c.id))})]}),e.jsx("footer",{className:"bg-gray-800 text-white py-8",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("p",{className:"text-center",children:["Â© ",new Date().getFullYear()," Teacher Review Platform || developed by A.A.Ahmad"]}),e.jsx("p",{className:"text-center mt-2",children:e.jsx(v,{to:"/admin/login",className:"text-gray-300 hover:text-white",children:"Admin Login"})})]})})]})};export{C as default};
