import{r as l,j as e,u as M,a as D,L as I}from"./index-9421cb2d.js";import{s as p,a as E}from"./api-5fb399bc.js";const v=({value:c,onChange:o,maxRating:a=5})=>{const[u,j]=l.useState(0),y=r=>{j(r)},x=()=>{j(0)},N=r=>{o(r)},w=r=>u>=r||!u&&c>=r?"text-yellow-400":"text-gray-300";return e.jsxs("div",{className:"flex items-center",children:[[...Array(a)].map((r,g)=>{const h=g+1;return e.jsx("button",{type:"button",className:`w-8 h-8 ${w(h)} cursor-pointer focus:outline-none transition-colors`,onClick:()=>N(h),onMouseEnter:()=>y(h),onMouseLeave:x,"aria-label":`Rate ${h} out of ${a}`,children:e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",className:"w-full h-full",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})})},g)}),c>0&&e.jsxs("span",{className:"ml-2 text-sm font-medium text-gray-700",children:[c," out of ",a]})]})},$=()=>{const{id:c}=M(),o=D(),[a,u]=l.useState(null),[j,y]=l.useState(!0),[x,N]=l.useState(!1),[w,r]=l.useState(null),[g,h]=l.useState(null),[k,f]=l.useState("disconnected"),[i,C]=l.useState({comment:"",metrics:{teaching:0,knowledge:0,engagement:0,approachability:0,responsiveness:0}});l.useEffect(()=>{const t=()=>f("connected"),s=()=>f("disconnected");return p.on("connect",t),p.on("disconnect",s),f(p.connected?"connected":"disconnected"),()=>{p.off("connect",t),p.off("disconnect",s)}},[]),l.useEffect(()=>{if(!c)return;(async()=>{try{y(!0);const s=await E.get(`/teachers/${c}`);u(s.data),f("connected")}catch(s){console.error("Error fetching teacher:",s),f("disconnected");const n=localStorage.getItem("teacherReviewApp_teachers");if(n)try{const m=JSON.parse(n).find(S=>S.id===c);m?u(m):o("/")}catch(d){console.error("Error parsing cached teachers:",d),o("/")}else o("/")}finally{y(!1)}})()},[c,o]);const R=t=>{C(s=>({...s,comment:t.target.value}))},b=(t,s)=>{C(n=>({...n,metrics:{...n.metrics,[t]:s}}))},T=t=>{const s=Object.values(t);return s.reduce((d,m)=>d+m,0)/s.length},A=async t=>{if(t.preventDefault(),i.comment.trim().length<10){r("Please provide a more detailed comment (at least 10 characters).");return}if(Object.values(i.metrics).some(n=>n===0)){r("Please rate all categories before submitting.");return}if(!a){r("Teacher information is missing.");return}N(!0),r(null);try{const n=T(i.metrics),d={teacherId:a.id,teacherName:a.name,studentName:"Anonymous Student",comment:i.comment,metrics:i.metrics,rating:n};if(await E.post("/reviews",d),k==="disconnected")try{const m=localStorage.getItem("teacherReviewApp_reviews")||"[]",S=JSON.parse(m);S.push({...d,id:Date.now().toString(),createdAt:new Date().toISOString(),status:"pending",sentiment:"neutral"}),localStorage.setItem("teacherReviewApp_reviews",JSON.stringify(S))}catch(m){console.error("Error saving review to local storage:",m)}h("Your review has been submitted for moderation and will be visible once approved!"),setTimeout(()=>{o(`/teacher/${c}`)},2e3)}catch(n){console.error("Error submitting review:",n),r("Failed to submit review. Please try again later."),N(!1)}};return j?e.jsx("div",{className:"flex h-screen w-full items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-xl",children:"Loading..."})}):a?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary-600 text-white py-6",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs(I,{to:`/teacher/${c}`,className:"text-white hover:text-white/80 transition-colors font-medium",children:["← Back to ",a.name,"'s Profile"]}),e.jsx("h1",{className:"text-3xl font-bold mt-2",children:"Write a Review"}),e.jsx("p",{className:"mt-1",children:"Your review will be posted anonymously"})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[k==="disconnected"&&e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsx("p",{className:"text-yellow-700",children:"Working in offline mode. Some features may be limited."})}),e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"card mb-6 flex items-center p-4",children:[e.jsx("div",{className:"flex-shrink-0 mr-4",children:e.jsx("img",{src:a.photo||"/assets/images/teacher-placeholder.jpg",alt:a.name,className:"w-16 h-16 rounded-full object-cover",onError:t=>{t.target.src="/assets/images/teacher-placeholder.jpg"}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:a.name}),e.jsx("p",{className:"text-gray-600",children:a.field})]})]}),g?e.jsxs("div",{className:"bg-green-100 border border-green-200 text-green-800 rounded-lg p-4 mb-6",children:[e.jsx("p",{className:"font-medium",children:g}),e.jsx("p",{className:"text-sm mt-1",children:"Redirecting you back to the teacher's profile..."})]}):e.jsx("form",{onSubmit:A,className:"card",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"comment",className:"block text-sm font-medium text-gray-700 mb-1",children:"Your Review"}),e.jsx("textarea",{id:"comment",rows:6,placeholder:"Write your honest review of this teacher...",className:"input-field resize-none",value:i.comment,onChange:R,required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Your review will be analyzed to calculate metrics automatically."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Rate this Teacher"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Teaching Quality"}),e.jsx(v,{value:i.metrics.teaching,onChange:t=>b("teaching",t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Knowledge"}),e.jsx(v,{value:i.metrics.knowledge,onChange:t=>b("knowledge",t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Engagement"}),e.jsx(v,{value:i.metrics.engagement,onChange:t=>b("engagement",t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Approachability"}),e.jsx(v,{value:i.metrics.approachability,onChange:t=>b("approachability",t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Responsiveness"}),e.jsx(v,{value:i.metrics.responsiveness,onChange:t=>b("responsiveness",t)})]})]})]}),w&&e.jsx("div",{className:"bg-red-100 border border-red-200 text-red-800 rounded-lg p-4 mb-6",children:w}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{type:"button",className:"btn-secondary mr-3",onClick:()=>o(`/teacher/${c}`),disabled:x,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:x,children:x?"Submitting...":"Submit Review"})]})]})})]})]}),e.jsx("footer",{className:"bg-gray-800 text-white py-8 mt-auto",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("p",{className:"text-center",children:["© ",new Date().getFullYear()," Teacher Review Platform || developed by A.A.Ahmad"]})})})]}):e.jsx("div",{className:"flex h-screen w-full items-center justify-center",children:e.jsx("div",{className:"text-xl text-red-600",children:"Teacher not found"})})};export{$ as default};
